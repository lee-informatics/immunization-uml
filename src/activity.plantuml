@startuml HL7_FHIR_Foundry_Architecture
!theme blueprint
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam RoundCorner 10
skinparam ArrowThickness 2

' Use left to right direction for better control
!define DIRECTION top to bottom direction

title HL7 FHIR Foundry Architecture

' Global colors
skinparam actorBackgroundColor #2C5282
skinparam actorFontColor #FFFFFF
skinparam componentBackgroundColor #63B3ED
skinparam componentFontColor #000000
skinparam databaseBackgroundColor #3182CE
skinparam databaseFontColor #FFFFFF
skinparam cloudBackgroundColor #48BB78
skinparam cloudFontColor #FFFFFF
skinparam nodeBackgroundColor #3182CE
skinparam nodeFontColor #FFFFFF
skinparam queueBackgroundColor #ED8936
skinparam queueFontColor #FFFFFF

' Future-state node styling
skinparam cloudBorderColor<<future>> #AAAAAA
skinparam nodeBorderColor<<future>> #AAAAAA
skinparam cloudFontColor<<future>> #555555
skinparam nodeFontColor<<future>> #555555

' ===== Development Layer =====
package "Development Community" as dev_pkg #F7FAFC {
  actor "Developer 1" as dev1
  actor "Developer 2" as dev2
  actor "Developer 3" as dev3
  component "Reference\nImplementations" as refs
  note right of refs
    Docker Images:
    - FHIR Server
    - SQL Database
    - Dashboard App
    - Stack Controller
  end note
}

' ===== Submission & Curation Layer =====
package "HL7 FHIR Foundry Platform" as platform_pkg #E6FFFA {
  queue "Submission\nQueue" as queue
  actor "Curator" as curator
  component "Individual Products" as products
  component "Product Bundles" as bundles
  database "Products\nRegistry" as registry
  component "**Foundry Gallery**\n(Public Catalog)" as gallery

  note right of products
    - FHIR Server
    - SQL Database
    - Dashboard App
    - CDS Services
    - etc.
  end note

  note right of bundles
    - FHIR + Database
    - Complete Immunization Stack
    - etc.
  end note

  note right of gallery
    **Gallery Features:**
    - Browse all products
    - Search by category
    - View documentation
    - Download compose files
    - Access "Try It Now" links
  end note
}

' ===== Deployment Layer =====
package "Deployment Options" as deploy_pkg #FFF5F5 {
  cloud "**HL7 Hosted**\n(Try It Now)" as hosted
  note bottom of hosted : Paid hosting option

  node "**Self-Hosted**\n(Docker Deployment)" as selfhost
  note bottom of selfhost : docker compose up

  cloud "**On-Demand Hosted Sandboxes**\n(Future)" as sandbox <<future>>
  note right of sandbox
    - Fully managed HL7-hosted environments
    - Configurable through Foundry UI
    - No PHI (synthetic/deidentified data only)
    - For development, testing, training
    - Always up-to-date via CI/CD
  end note

  node "**Private User-Provided Environments**\n(Future)" as privateenv <<future>>
  note right of privateenv
    - Deployed into user-managed infrastructure
    - Can integrate with local production systems
    - Full control over data (PHI allowed)
    - Operated within corporate or private clouds
    - Supports custom integrations
  end note
}

' ===== End Users Layer (Below Deployment) =====
package "End Users" as users_pkg #8A9BA8 {
  actor "Healthcare Org" as org1
  actor "Developers" as org2
}

' Force package ordering
dev_pkg -[hidden]down-> platform_pkg
platform_pkg -[hidden]down-> deploy_pkg
deploy_pkg -[hidden]down-> users_pkg

' ===== Flow Arrows =====
dev1 --> refs : Creates
dev2 --> refs
dev3 --> refs
refs --> queue : Submit for\nReview
queue --> curator : Reviews &\nApproves
curator --> products : Publishes\nProducts
curator --> bundles : Creates\nBundles
products --> registry : Added to
bundles --> registry : Added to
registry --> gallery : Listed in

' Color-coded arrows for deployments
gallery -[#48BB78]-> hosted : Deploy for\nPublic Access
gallery -[#3182CE]-> selfhost : Download &\nDeploy
gallery -[#AAAAAA]-> sandbox : Provision\nSandbox Env (Future)
gallery -[#AAAAAA]-> privateenv : Deploy to\nPrivate Env (Future)

' Color-coded arrows from deployments to users
hosted -[#48BB78]--> org1
hosted -[#48BB78]--> org2
selfhost -[#3182CE]--> org2
sandbox -[#AAAAAA]--> org2
privateenv -[#AAAAAA]--> org1 
privateenv -[#AAAAAA]--> org2

' ===== Feedback Loop =====
curator -left-> refs : Feedback / Fixes\nfor Foundry compliance

' ===== Curator Responsibilities =====
note right of curator
  **Curator Responsibilities:**
  - Quality review
  - Security verification
  - Standards compliance
  - Bundle creation
end note

' ===== Legend =====
legend right
  |= Color |= Component |
  |<#2C5282> | Actors/Core Components |
  |<#48BB78> | HL7-Hosted Deployments |
  |<#3182CE> | Self-Hosted Options |
  |<#AAAAAA> | Future-State Options |
  |<#ED8936> | Process Queue |
  |<#63B3ED> | Development Assets |
endlegend

@enduml